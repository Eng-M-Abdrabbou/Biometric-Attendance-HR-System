<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance System Dashboard</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
    }
    
    header {
        background-color: #333;
        color: #fff;
        text-align: center;
        padding: 1rem;
    }
    
    main {
        padding: 2rem;
    }
    
    #filters {
        background-color: #fff;
        padding: 1rem;
        margin-bottom: 2rem;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    #filter-form {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        align-items: center;
    }
    
    #filter-form label {
        font-weight: bold;
    }
    
    #filter-form input,
    #filter-form select {
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 3px;
    }
    
    #filter-form button {
        background-color: #333;
        color: #fff;
        border: none;
        padding: 0.5rem 1rem;
        cursor: pointer;
        border-radius: 3px;
    }
    
    #attendance-report {
        background-color: #fff;
        padding: 1rem;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .department-section {
        margin-bottom: 2rem;
    }
    
    .department-section h3 {
        background-color: #eee;
        padding: 0.5rem;
        margin-bottom: 1rem;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
    }
    
    th, td {
        border: 1px solid #ddd;
        padding: 0.5rem;
        text-align: left;
    }
    
    th {
        background-color: #f2f2f2;
        font-weight: bold;
    }
    
    footer {
        background-color: #333;
        color: #fff;
        text-align: center;
        padding: 1rem;
        position: fixed;
        bottom: 0;
        width: 100%;
    }

    </style>
</head>
<body>
    <header>
        <h1>Attendance System Dashboard</h1>
    </header>
    <main>
        <section id="filters">
            <h2>Filters</h2>
            <form id="filter-form">
                <label for="date-range">Date Range:</label>
                <input type="date" id="start-date" name="start-date">
                <input type="date" id="end-date" name="end-date">
                
                <label for="department">Department:</label>
                <select id="department" name="department">
                    <option value="">All Departments</option>
                </select>
                
                <button type="submit">Apply Filters</button>
            </form>
        </section>
        <section id="attendance-report">
            <h2>Attendance Report</h2>
            <div id="report-container"></div>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Your Company Name. All rights reserved.</p>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script>

      // script.js
document.addEventListener('DOMContentLoaded', () => {
  const filterForm = document.getElementById('filter-form');
  const reportContainer = document.getElementById('report-container');
  const departmentSelect = document.getElementById('department');

  // Fetch departments and populate the select element
  fetchDepartments();

  filterForm.addEventListener('submit', (e) => {
      e.preventDefault();
      fetchAttendanceData();
  });

  async function fetchDepartments() {
      try {
          const response = await fetch('/api/departments');
          const departments = await response.json();
          departments.forEach(dept => {
              const option = document.createElement('option');
              option.value = dept.id;
              option.textContent = dept.name;
              departmentSelect.appendChild(option);
          });
      } catch (error) {
          console.error('Error fetching departments:', error);
      }
  }

  async function fetchAttendanceData() {
      const startDate = document.getElementById('start-date').value;
      const endDate = document.getElementById('end-date').value;
      const department = departmentSelect.value;

      try {
          const response = await fetch(`/api/attendance-report?startDate=${startDate}&endDate=${endDate}&department=${department}`);
          const data = await response.json();
          displayAttendanceReport(data);
      } catch (error) {
          console.error('Error fetching attendance data:', error);
          reportContainer.innerHTML = '<p>Error fetching attendance data. Please try again.</p>';
      }
  }

  function displayAttendanceReport(data) {
      reportContainer.innerHTML = '';

      const groupedByDepartment = groupByDepartment(data);

      for (const [department, employees] of Object.entries(groupedByDepartment)) {
          const departmentSection = createDepartmentSection(department, employees);
          reportContainer.appendChild(departmentSection);
      }
  }

  function groupByDepartment(data) {
      return data.reduce((acc, record) => {
          if (!acc[record.department]) {
              acc[record.department] = [];
          }
          acc[record.department].push(record);
          return acc;
      }, {});
  }

  function createDepartmentSection(department, employees) {
      const section = document.createElement('div');
      section.className = 'department-section';
      section.innerHTML = `<h3>${department}</h3>`;

      const table = document.createElement('table');
      table.innerHTML = `
          <thead>
              <tr>
                  <th>Date</th>
                  <th>Employee ID</th>
                  <th>Name</th>
                  <th>Designation</th>
                  <th>First In</th>
                  <th>Last Out</th>
                  <th>Status</th>
                  <th>AWH</th>
                  <th>OT</th>
              </tr>
          </thead>
          <tbody>
              ${employees.map(emp => `
                  <tr>
                      <td>${emp.date}</td>
                      <td>${emp.emp_id}</td>
                      <td>${emp.emp_name}</td>
                      <td>${emp.designation}</td>
                      <td>${emp.first_in}</td>
                      <td>${emp.last_out}</td>
                      <td>${emp.status}</td>
                      <td>${emp.awh}</td>
                      <td>${emp.ot}</td>
                  </tr>
              `).join('')}
          </tbody>
      `;

      section.appendChild(table);
      return section;
  }
});

    </script>
</body>
</html>