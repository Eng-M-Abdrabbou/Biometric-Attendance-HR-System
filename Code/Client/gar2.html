<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAR Report</title>
    <style>
        .container { padding: 2px; }
        .filter-form { 
            margin-bottom: 2px; 
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .filter-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .filter-item {
            flex: 1;
            min-width: 200px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 2px;
            font-size: smaller;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th { background-color: #f4f4f4; }
        .filter-buttons {
            display: flex;
            gap: 10px;
        }
        button {
            padding: 8px 16px;
            cursor: pointer;
        }


/* General Container */
.container {
    max-width: 1450px;
    margin: 20px auto;
    padding: 20px;
    background-color: #f5f5f5;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    font-family: Arial, sans-serif;
}

/* Page Header */
h1 {
    color: #333;
    font-size: 28px;
    text-align: center;
    font-weight: bold;
    margin-bottom: 20px;
}

/* Company Info */
#reportDataContainer img {
    display: block;
    margin: 0 auto 20px;
}

#reportDataContainer h1,
#reportDataContainer p,
#reportDataContainer h3,
#reportDataContainer h2 {
    text-align: center;
}

#reportDataContainer p {
    font-size: 14px;
    color: #555;
    margin: 4px 0;
}

/* Filter Form Styling */
.filter-form {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-bottom: 20px;
    background-color: #fff;
    padding: 15px;
    border-radius: 6px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.filter-group {
    display: flex;
    flex: 1;
    gap: 12px;
}

.filter-item {
    display: flex;
    flex-direction: column;
    min-width: 200px;
}

.filter-item label {
    font-size: 14px;
    color: #333;
    margin-bottom: 6px;
}

.filter-item input[type="date"],
.filter-item input[type="text"],
.filter-item select {
    padding: 8px;
    font-size: 14px;
    border-radius: 4px;
    border: 1px solid #ddd;
}

.filter-item input[type="text"]::placeholder {
    color: #aaa;
}

/* Filter Buttons */
.filter-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-start;
    padding-top: 10px;
}

.filter-buttons button {
    padding: 8px 16px;
    font-size: 14px;
    color: #fff;
    background-color: #007bff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.filter-buttons button:hover {
    background-color: #0056b3;
}

#resetFilters {
    background-color: #6c757d;
}

#resetFilters:hover {
    background-color: #5a6268;
}

#triggerSync {
    background-color: #28a745;
}

#triggerSync:hover {
    background-color: #218838;
}

/* Loading Spinner */
.loading-spinner {
    display: none;
    text-align: center;
    font-size: 18px;
    color: #007bff;
    padding: 20px;
}

/* Debug Panel */
#debugLog {
    margin: 20px 0;
    padding: 10px;
    background-color: #f8f9fa;
    border: 1px solid #ddd;
    border-radius: 4px;
    color: #333;
}

#debugLog h3 {
    font-size: 16px;
    font-weight: bold;
}

#debugOutput {
    white-space: pre-wrap;
    font-family: monospace;
    font-size: 14px;
}

/* Error Message */
.error-message {
    display: none;
    color: #d9534f;
    background-color: #f8d7da;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 20px;
}

/* Pagination Controls */
.pagination-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 14px;
    margin-top: 20px;
}

.pagination-controls button {
    padding: 6px 12px;
    font-size: 14px;
    background-color: #007bff;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.pagination-controls button:hover {
    background-color: #0056b3;
}

.pagination-controls input[type="number"] {
    width: 50px;
    padding: 6px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

/* Print Buttons */
#btn-export, #printButton {
    display: block;
    margin: 10px 0;
    padding: 8px;
    font-size: 14px;
    background-color: #ff6b6b;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#btn-export:hover, #printButton:hover {
    background-color: #d9534f;
}

/* Additional Styling */
button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
}



    </style>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.2.1/exceljs.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
   
    <style>
        /* Reset and Font */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    
        body {
            background-color: #f5f5f5;
            padding: 0 30px 30px 30px; /* Adjusted padding to account for fixed navbar */
            overflow-x: hidden;
            margin-top: 80px; /* Added margin to prevent content from hiding behind navbar */
        }
    
    
    
        /* Navbar Styles */
        .navbar {
            background-color: #943240;
            padding: 2px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
            overflow: visible; /* Ensure tooltips are visible */
            position: fixed; /* Make navbar fixed at the top */
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000; /* Ensure navbar stays above other elements */
        }
    
    
    
        .navbar a {
            color: white;
            text-decoration: none;
            font-size: 18px;
            margin-right: 20px;
            transition: color 0.3s;
            display: flex;
            align-items: center;
        }
    
    
    
        .navbar a:hover {
            color: #ddd;
        }
    
    
    
        .navbar .navbar-brand {
            font-size: 24px;
            font-weight: bold;
        }
    
    
    
        .navbar .navbar-menu {
            display: flex;
            align-items: center;
            list-style: none;
            overflow: visible; /* Ensure tooltips are visible */
        }
    
    
    
        .navbar .navbar-menu li {
            list-style: none;
            position: relative; /* For tooltip positioning */
            overflow: visible; /* Ensure tooltips are visible */
            margin-left: 20px;
        }
    
    
    
        .navbar i {
            font-size: 20px;
        }
    
    
    
        /* Tooltip Styles */
        .tooltip {
            position: relative;
            display: inline-block;
    
            position: relative;
            display: inline-block;
        }
    
    
    
        .tooltip .tooltip-text {
            visibility: hidden;
            background-color: #333;
            color: white;
            text-align: center;
            padding: 6px 10px;
            border-radius: 6px;
            position: absolute;
            z-index: 9999; /* Ensures tooltip is above other elements */
            top: 125%; /* Positions the tooltip below the icon */
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
    
    
    
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            bottom: 100%; /* Arrow pointing upwards */
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent #333 transparent;
        }
    
    
    
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
            
        }
    
    
    
        /* Existing Styles */
        .controls-container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            flex-direction: row;
            gap: 20px;
            animation: slideIn 0.5s ease-in-out;
    
             display: flex;
    flex-wrap: nowrap; /* Ensures all elements stay on one line */
    gap: 20px; /* Adds spacing between groups */
    align-items: center; /* Aligns items vertically in the center */
        }
    
    
    
        .controls-group {
            display: flex;
            flex-direction: row;
            gap: 15px;
    
            display: flex;
    flex-direction: row; /* Keeps the inner elements stacked vertically */
    align-items: start; /* Aligns label and inputs to the start */
    gap: 10px; /* Adds spacing between internal elements */
        }
    
    
    
        .date-controls, .distribution-controls, .visa-controls {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
    
            display: flex;
    flex-direction: row; /* Keeps the label, input, and buttons stacked */
    gap: 10px;
        }
    
    
    
        label {
            font-weight: 500;
            color: #666;
            font-size: 15px;
        }
    
    
    
        input[type="date"], select {
            padding: 12px 18px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            background-color: #f9f9f9;
            transition: border-color 0.3s, transform 0.3s;
        }
    
    
    
        input[type="date"]:focus, select:focus {
            outline: none;
            border-color: #943240;
            transform: scale(1.02);
        }
    
    
    
        button {
            position: relative;
            overflow: hidden;
            color: white;
            background-color: #943240;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            transition: background-color 0.3s, box-shadow 0.3s, transform 0.3s;
            animation: fadeInUp 0.6s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    
    
    
        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }
    
    
    
        button:hover {
            background-color: #7a2a35;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }
    
    
    
        button:hover::after {
            width: 200px;
            height: 200px;
        }
    
    
    
        button i {
            margin-right: 8px;
        }
    
    
    
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
    
    
    
        .chart-container {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.4s;
            animation: zoomIn 0.6s ease-in-out;
            max-width: 500px;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }
    
    
    
        canvas {
            max-width: 100%;
            width: 400px;
            height: 400px;
        }
    
    
    
        .chart-details-box {
            background-color: #f9f9f9;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 20px;
            width: 100%;
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
    
    
    
        .chart-details-box span {
            display: block;
            margin-bottom: 10px;
            font-size: 14px;
            color: #333;
    
        }
    
    
    
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            animation: fadeIn 0.6s ease-in-out;
        }
    
    
    
        th, td {
            padding: 12px 18px;
            border: 1px solid #ddd;
            text-align: left;
            font-size: 12px;
        }
    
    
    
        th {
    
            background-color: #943240;
            color: white;
            font-weight: 500;
    
        }
    
    
    
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    
    
    
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    
    
    
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    
    
    
        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <!-- FontAwesome for Icons -->
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    >
    </head>
    <body>
    
    
        <!-- Navbar -->
        <nav class="navbar">
            <img src="./Images/Logo/Company Logo.png" alt="Logo" class="navbar-logo" style="width: 190px; height: 70px; object-fit: cover;">
        <div class="navbar-brand" style="margin-right: -180px;">General Attendance Report</div>
            <ul class="navbar-menu">
                <li>
                    <div class="tooltip">
                        <a href="http://localhost:8000/home.html"><i class="fas fa-home"></i></a>
                        <span class="tooltip-text">Home</span>
                    </div>
                </li>
                <li>
                    <div class="tooltip">
                        <a href="http://localhost:8000/gar"><i class="fas fa-file-alt"></i></a>
                        <span class="tooltip-text">General Attendance Report</span>
                    </div>
                </li>
                <li>
                    <div class="tooltip">
                        <a href="http://localhost:8000/muster_roll"><i class="fas fa-list-alt"></i></a>
                        <span class="tooltip-text">Muster Roll Report</span>
                    </div>
                </li>
                <li>
                    <div class="tooltip">
                        <a href="http://localhost:8000/Admin_CRUD.html"><i class="fas fa-user-cog"></i></a>
                        <span class="tooltip-text">Admin Dashboard</span>
                    </div>
                </li>
                <li>
                    <div class="tooltip">
                        <a href="http://localhost:8000/email.html"><i class="fas fa-envelope"></i></a>
                        <span class="tooltip-text">Email Notification</span>
                    </div>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="signout()">
                      Sign Out
                    </a>
                  </li>

            </ul>
        </nav>
    


    <div class="container">
        <h1>General Attendance Report</h1>
        
        <!-- Debug Toggle Button -->
        <button id="debugToggle" onclick="toggleDebugLog()" style="display: none;">Toggle Debug Log</button>
        
        <!-- Debug Log Panel -->
        <div id="debugLog" class="debug-log" style="display: none;">
            <h3>Debug Log:</h3>
            <pre id="debugOutput"></pre>
        </div>

        <!-- Error Message Display -->
        <div id="errorMessage" class="error-message" style="display: none;"></div>

<table>
    <tr>
        <td>
            <div class="filter-form">
                <div class="filter-group">
                    <div class="filter-item">
                        <label for="dateFrom">Date From:</label>
                        <input type="date" id="dateFrom" name="dateFrom">
                    </div>
                    <div class="filter-item">
                        <label for="dateTo">Date To:</label>
                        <input type="date" id="dateTo" name="dateTo">
                    </div>
                    <div class="filter-item">
                        <label for="empId">Employee ID:</label>
                        <input type="text" id="empId" name="empId" placeholder="Enter employee ID">
                    </div>
                    <div class="filter-item">
                        <label for="empName">Employee Name:</label>
                        <input type="text" id="empName" name="empName" placeholder="Enter employee name">
                    </div>
                    <div class="filter-item">
                        <label for="department">Department:</label>
                        <select id="department" name="department">
                            <option value="">All Departments</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="site">Site:</label>
                        <select id="site" name="site">
                            <option value="">All Sites</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="nationality">Nationality:</label>
                        <select id="nationality" name="nationality">
                            <option value="">All Nationalities</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="visa">Visa:</label>
                        <select id="visa" name="visa">
                            <option value="">All Visas</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="statusFilter">Status:</label>
                        <select id="statusFilter" name="statusFilter">
                            <option value="">All</option>
                            <option value="P">Present</option>
                            <option value="A">Absent</option>
                            <option value="MS">Miss Swipe</option>
                            <option value="W">Weekend</option>
                        </select>
                    </div>                    
                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class="filter-buttons">
                <button id="fetchReport">Apply Filters</button>
                <button id="resetFilters">Reset Filters</button> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
                <button style="display: none;" id="printButton" onclick="printDivAsPDF('reportDataContainer')">Print Report As PDF</button>
                <button style="display: none;" id="btn-export">Print Report as XLSX(Excel)</button>
                <button id="triggerSync">Refresh Data</button>
            </div>
        </td>
    </tr>
</table>
       
        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading-spinner">
            Loading... Please wait...
        </div>
<!-- Add below the reportContainer div -->
<div id="paginationControls" class="pagination-controls" style="display: none;">
    <button id="prevPage">Previous</button>
    <span>Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
    <button id="nextPage">Next</button>
    <p> Jump to Page </p>
    <input type="number" id="jumpPageInput" min="1" placeholder="Page No." style="width: 50px;">
    <button id="jumpPageButton">Go</button>
</div>

<div id="reportDataContainer">
            <div>  
<img sizes="50px" width="800px" height="160px" src="Images\Logo\Company Logo.png" alt="FEDERAL ELECTRIC Company Logo">
<h1>FEDERAL ELECTRIC</h1>
<p > PO BOX 9769,Mussafah, Abu Dhabi, UAE.                                  </p>
<p >  Contact Numbers: +971 2 5592229 / 5512788                             </p>
<p >  Email: info@federalelectricals.com Website: www.federalelectricals.com</p>
<br>
<h3>Biometric attendance System</h3>
<br>
<h2 style="text-align: center; margin-top: 20px; margin-bottom: 20px; font-weight: bold; font-size: 20px; 
color: black; font-family: Arial, sans-serif; text-transform: uppercase; ">GENERAL ATTENDANCE REPORT</h2>

            </div>
        <div id="reportContainer"></div>
            
    </div> 
<div>
    <br>
    <br>
    <br>
<hr style="border: 1px solid black;">
<p style="font-family:Arial, Helvetica, sans-serif;">
<span><b>Note:&nbsp;&nbsp;&nbsp;</b></span>
AWH = Actual Working Hours &nbsp;&nbsp;&nbsp; OT = Over Time &nbsp;&nbsp;&nbsp; SS = Shift Start &nbsp;&nbsp;&nbsp; SE = Shift End &nbsp;&nbsp;&nbsp;
DCI = Did Not Clock In &nbsp;&nbsp;&nbsp; DCO = Did Not Clock Out &nbsp;&nbsp;&nbsp; LGT = Late Grace Time &nbsp;&nbsp;&nbsp; W = Weekend <br>
ST = Shift Type &nbsp;&nbsp;&nbsp; SS = Shift Start &nbsp;&nbsp;&nbsp; SE = Shift End &nbsp;&nbsp;&nbsp; 
BH = Break Hours &nbsp;&nbsp;&nbsp; TABS = Time Allowed Before Shift  &nbsp;&nbsp;&nbsp; 
SII = Shift Incharge ID &nbsp;&nbsp;&nbsp; TWHB = Total Working Hours Before &nbsp;&nbsp;&nbsp;
P = Present &nbsp;&nbsp;&nbsp; A = Absent &nbsp;&nbsp;&nbsp; MS = Miss Swipe  &nbsp;&nbsp;&nbsp;SL = Sick Leave &nbsp;&nbsp;&nbsp; AL = Annual Leave &nbsp;&nbsp;&nbsp;
CLL = Continuous Learning Leave &nbsp;&nbsp;&nbsp; HL = Hajj Leave &nbsp;&nbsp;&nbsp;ML = Marriage Leave&nbsp;&nbsp;&nbsp; CL = Compassionate Leave <br>
BTL = Business Travel Leave &nbsp;&nbsp;&nbsp;PL = Paternity Leave&nbsp;&nbsp;&nbsp;PESL = Patient Escorting Leave&nbsp;&nbsp;&nbsp;PRL = Parental Leave <br>
</p>

</div>
    <script>

        //sign out function
        
    function signout() {
      // Terminate the session
      fetch('/signout', { method: 'POST' })
        .then(() => {
          // Redirect to the login page
          window.location.href = '/';
        })
        .catch((err) => {
          console.error('Error signing out:', err);
        });
    } 

        // session ifo
    fetch('/session-info')
      .then((response) => response.json())
      .then((data) => {
        console.log('Session info:', data.session);
      })
      .catch((error) => console.error(error));

// const moment = require('moment'); 
document.getElementById('statusFilter').addEventListener('change', () => {
    applyStatusFilter();
});

function applyStatusFilter() {
    const filterValue = document.getElementById('statusFilter').value;
    const tableRows = document.querySelectorAll('#reportContainer table tbody tr');

    tableRows.forEach(row => {
        const statusCell = row.querySelector('td:nth-child(10)'); // Assuming "Status" is the 10th column
        if (statusCell) {
            const status = statusCell.textContent.trim();
            if (filterValue === '' || status === filterValue) {
                row.style.display = ''; // Show row
            } else {
                row.style.display = 'none'; // Hide row
            }
        }
    });
}





        // Debug logging function
        function logDebug(message, data = null) {
            const timestamp = new Date().toISOString();
            let logMessage = `[${timestamp}] ${message}`;
            if (data) {
                logMessage += '\nData: ' + JSON.stringify(data, null, 2);
            }
            const debugOutput = document.getElementById('debugOutput');
            debugOutput.innerHTML += logMessage + '\n\n';
            console.log(logMessage);
        }

        // Error handling function
        function showError(message, error = null) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerHTML = `Error: ${message}`;
            if (error) {
                errorDiv.innerHTML += `<br>Details: ${error.message}`;
                logDebug('Error occurred', { message, error: error.message });
            }
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Toggle debug log visibility
        function toggleDebugLog() {
            const debugLog = document.getElementById('debugLog');
            debugLog.style.display = debugLog.style.display === 'none' ? 'block' : 'none';
        }

        // Load dropdown options when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            logDebug('Page loaded, initializing...');
            try {
                await loadFilterOptions();
                // Load initial data without filters
                await fetchGARReport();
            } catch (error) {
                showError('Failed to initialize page', error);
            }
        });

        async function loadFilterOptions() {
            logDebug('Loading filter options');
            try {
                const response = await fetch('/api/filter-options');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                logDebug('Received filter options', data);
                
                await populateSelect('department', data.departments);
                await populateSelect('site', data.sites);
                await populateSelect('nationality', data.nationalities);
                await populateSelect('visa', data.visa);
                
                logDebug('Filter options loaded successfully');
            } catch (error) {
                showError('Error loading filter options', error);
            }
        }

        async function populateSelect(id, options) {
            logDebug(`Populating ${id} dropdown`, options);
            const select = document.getElementById(id);
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option.id;
                opt.textContent = option.name;
                select.appendChild(opt);
            });
        }

        document.getElementById('fetchReport').addEventListener('click', () => {
            logDebug('Fetch report button clicked');
            fetchGARReport();
        });

        document.getElementById('resetFilters').addEventListener('click', () => {
            logDebug('Reset filters button clicked');
            resetFilters();
        });

        function resetFilters() {
            logDebug('Resetting all filters');
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.getElementById('empId').value = '';
            document.getElementById('empName').value = '';
            document.getElementById('department').value = '';
            document.getElementById('site').value = '';
            document.getElementById('nationality').value = '';
            document.getElementById('visa').value = '';
            
            // Fetch report without filters after reset
            fetchGARReport();
        }



async function fetchGARReport() {
    const loadingSpinner = document.getElementById('loadingSpinner');
    loadingSpinner.style.display = 'block';
    logDebug('Fetching report.........................');
    try {
        // Retrieve filter values with null-safe checks
        const dateFromElement = document.getElementById('dateFrom');
        const dateToElement = document.getElementById('dateTo');
        const empIdElement = document.getElementById('empId');
        const empNameElement = document.getElementById('empName');
        const departmentElement = document.getElementById('department');
        const siteElement = document.getElementById('site');
        const nationalityElement = document.getElementById('nationality');
        const visaElement = document.getElementById('visa');

        // Ensure all elements exist
        if (!dateFromElement || !dateToElement || !empIdElement || !empNameElement || !departmentElement || !siteElement || !nationalityElement || !visaElement) {
            throw new Error('One or more filter elements are missing in the DOM.');
        }

        const filters = {
            dateFrom: dateFromElement.value || '',
            dateTo: dateToElement.value || '',
            empId: empIdElement.value || '',
            empName: empNameElement.value || '',
            department: departmentElement.value || '',
            site: siteElement.value || '',
            nationality: nationalityElement.value || '',
            visa: visaElement.value || ''
        };

        logDebug('Fetching report with filters', filters);

        // Only include non-empty filters in the query string
        const queryString = new URLSearchParams(
            Object.fromEntries(
                Object.entries(filters).filter(([_, v]) => v !== '')
            )
        ).toString();

        logDebug('Generated query string', queryString);

        const response = await fetch(`/api/attendance-report${queryString ? `?${queryString}` : ''}`);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();

        // Validate the structure of the received data
        if (!data || typeof data !== 'object') {
            throw new Error('Received invalid data format from the server.');
        }

        if (!('recordCount' in data) || !('totalRecords' in data) || !('data' in data)) {
            throw new Error('Incomplete data received from the server.');
        }

        logDebug('Received report data', data);

        displayReport(data);
        document.getElementById('printButton').style.display = 'block';
        document.getElementById('btn-export').style.display = 'block';
        document.getElementById('paginationControls').style.display = 'block';
        logDebug('Report displayed successfully');
    } catch (error) {
        showError('Error fetching report', error.message);
        document.getElementById('reportContainer').innerHTML = '<p>Error fetching report. Please try again.</p>';
        logDebug('Error fetching report details', error);
    } finally {
        loadingSpinner.style.display = 'none';
    }
}





        // Validate date range
        function validateDateRange(dateFrom, dateTo) {
            if (dateFrom && dateTo) {
                const fromDate = new Date(dateFrom);
                const toDate = new Date(dateTo);
                if (fromDate > toDate) {
                    showError('Date From cannot be later than Date To');
                    return false;
                }
            }
            return true;
        }



function displayReport(data) {
    console.log(data);
    const container = document.getElementById('reportContainer');
    if (Object.keys(data).length === 0) {
        container.innerHTML = '<p>No data available.</p>';
        return;
    }

    let html = '';

    for (const [shiftId, shiftData] of Object.entries(data)) {
        console.log(shiftData);
        html += `
            <h2 style="color: red;">&nbsp;&nbsp;Shift: ${shiftData.shift_name}</h2>
            <table>
                <tr>
                    <th>ST</th>
                    <th>SS</th>
                    <th>SE</th>
                    <th>BH</th>
                    <th>TABS</th>
                    <th>SII</th>
                    <th>TWHB</th>
                    <th>LGT in Mins</th>
                </tr>
                <tr>
                    <td>${shiftData.shift_type}</td>
                    <td>${shiftData.shift_start}</td>
                    <td>${shiftData.shift_end}</td>
                    <td>${shiftData.hours_allowed_for_break}</td>
                    <td>${shiftData.time_allowed_before_shift}</td>
                    <td>${shiftData.shift_incharge}</td>
                    <td>${shiftData.total_working_hours_before}</td>
                    <td>${shiftData.lgt_in_minutes}</td>
                </tr>
            </table>
        `;
    //     function isString(value) {
    //     return typeof value === 'string';
    // }
        for (const [siteId, siteData] of Object.entries(shiftData.sites)) {
            html += `<h3 style="color: blue;">&nbsp;&nbsp;Site: ${siteData.site_name}</h3>`;

            for (const [depId, depData] of Object.entries(siteData.departments)) {
                html += `<h4 style="color: green;">&nbsp;&nbsp;Department: ${depData.department_name}</h4>`;
                html += `
                    <table>
                        <thead>
                            <tr>
                                 <th>Date</th>
                                <th>Emp. ID</th>
                                <th>Emp. Name</th>
                                <th>Grade</th>
                                <th>Designation</th>                               
                                <th>First In</th>
                                <th>Last Out</th>
                                <th>SS</th>
                                <th>SE</th>
                                <th>Status</th>
                                <th>AWH</th>
                                <th>OT</th>
                            </tr>
                        </thead>
                        <tbody>
                `;


                for (const [empId, empData] of Object.entries(depData.employees)) {
                    
                    
                    

                //     empData.attendance.sort((a, b) => {
                //   const dateA = new Date(a.shift_date);
                //   const dateB = new Date(b.shift_date);
                //   return dateA - dateB;
                // });



empData.attendance.sort((a, b) => {
  const dateA = new Date(a.shift_date.split('-').reverse().join('-')); // assume format is 'DD-MM-YYYY'
  const dateB = new Date(b.shift_date.split('-').reverse().join('-')); // assume format is 'DD-MM-YYYY'
  return dateA - dateB;
});





                    empData.attendance.forEach((record, index) => {
                        // if (isString(record.awh)) {
                        //     return; // skip rows where awh is a string
                        // }
                        // console.log("The leave is heeeeeeeeeeeeeeeeere", record.leave);
                        // console.log("The leave is heeeeeeeeeeeeeeeeere", record.leave_id,"id");
                        // console.log("The leave is heeeeeeeeeeeeeeeeere", record.awh,"awh");


                        let newawh1 = Math.floor(record.awh);
                        let newawh2 = Math.floor((record.awh % 1) * 100);
                        if (isNaN(newawh1) || isNaN(newawh2)) {                        
                            newawh1 = 0;
                            newawh2 = 0;
                        }
                        if (newawh1 < 10) {
                            newawh1 = `0${newawh1}`;
                        }
                        if (newawh2 < 10) {
                            newawh2 = `0${newawh2}`;
                        }

                        let newot1 = Math.floor(record.ot);
                        let newot2 = Math.floor((record.ot % 1) * 100);
                        if (isNaN(newot1) || isNaN(newot2)) {
                            newot1 = 0;
                            newot2 = 0;
                        }
if (newot1 < 10) {
    newot1 = `0${newot1}`;
}
if (newot2 < 10) {
    newot2 = `0${newot2}`;
}
                        
                        let firstIn = record.first_in == "Invalid date" || record.first_in === null || record.first_in === '00:00:00' ? "DCI" : record.first_in;
                        let lastOut = record.last_out == "Invalid date" || record.last_out === null || record.last_out === '00:00:00' ? "DCO" : record.last_out;
if(shiftId === '3'){

    let firstIn = record.first_in == "Invalid date" || record.first_in === null ? "DCI" : record.first_in;
    let lastOut = record.last_out == "Invalid date" || record.last_out === null ? "DCO" : record.last_out;
 if(firstIn =='00:00:00'){
    firstIn = "--------";
 }
 if(lastOut == '00:00:00'){
    lastOut = "--------";
 }

 console.log("The leave is heeeeeeeeeeeeeeeeere", record.leave);


if(record.leave != 11){
console.log("The leave is heeeeeeeeeeeeeeeeere",record.leave);
    switch(record.leave) {
    case 1:
        record.status = "SL";
        break;
    case 2:
        record.status = "AL";
        break;
    case 3:
        record.status = "CLL";
        break;
    case 4:
        record.status = "HL";
        break;
    case 5:
        record.status = "ML";
        break;
    case 6:
        record.status = "CL";
        break;
    case 7:
        record.status = "BTL";
        break;
    case 8:
        record.status = "PL";
        break;
    case 9:
        record.status = "PESL";
        break;
    case 10:
        record.status = "PRL";
        break;
    case 11:
        record.status = "No";
        break;
    default:
        record.status = record.status;
        break;
}
}
 //if
    
    html += `
                            <tr>
                                <td>${record.shift_date}</td>
                                ${index === 0 ? `<td rowspan="${empData.attendance.length}">${empId}</td>` : ''}
                                ${index === 0 ? `<td rowspan="${empData.attendance.length}">${empData.emp_name}</td>` : ''}
                                ${index === 0 ? `<td rowspan="${empData.attendance.length}">${empData.grade || 'N/A'}</td>` : ''}
                                ${index === 0 ? `<td rowspan="${empData.attendance.length}">${empData.designation || 'N/A'}</td>` : ''}
                                <td>${firstIn}</td>
                                <td>${lastOut}</td>
                                <td>${shiftData.shift_start}</td>
                                <td>${shiftData.shift_end}</td>
                                <td>${record.status}</td>
                                <td>${newawh1}:${newawh2}</td>
                                <td>${newot1}:${newot2}</td>
                            </tr>
                        `;
} else {
    

    if(record.leave != 11){
console.log("The leave is heeeeeeeeeeeeeeeeere",record.leave);
    switch(record.leave) {
    case 1:
        record.status = "SL";
        break;
    case 2:
        record.status = "AL";
        break;
    case 3:
        record.status = "CLL";
        break;
    case 4:
        record.status = "HL";
        break;
    case 5:
        record.status = "ML";
        break;
    case 6:
        record.status = "CL";
        break;
    case 7:
        record.status = "BTL";
        break;
    case 8:
        record.status = "PL";
        break;
    case 9:
        record.status = "PESL";
        break;
    case 10:
        record.status = "PRL";
        break;
    case 11:
        record.status = "No";
        break;
    default:
        record.status = record.status;
        break;
}
}


    html += `
                            <tr>
                                <td>${record.shift_date}</td>
                                ${index === 0 && empData.attendance[1] && empData.attendance[1].shift_date === record.shift_date ? `<td rowspan="${empData.attendance.filter(r => r.shift_date === record.shift_date).length}">${empId}</td>` : `<td>${empId}</td>`}
                                ${index === 0 && empData.attendance[1] && empData.attendance[1].shift_date === record.shift_date ? `<td rowspan="${empData.attendance.filter(r => r.shift_date === record.shift_date).length}">${empData.emp_name}</td>` : `<td>${empData.emp_name}</td>`}
                                ${index === 0 && empData.attendance[1] && empData.attendance[1].shift_date === record.shift_date ? `<td rowspan="${empData.attendance.filter(r => r.shift_date === record.shift_date).length}">${empData.grade || 'N/A'}</td>` : `<td>${empData.grade || 'N/A'}</td>`}
                                ${index === 0 && empData.attendance[1] && empData.attendance[1].shift_date === record.shift_date ? `<td rowspan="${empData.attendance.filter(r => r.shift_date === record.shift_date).length}">${empData.designation || 'N/A'}</td>` : `<td>${empData.designation || 'N/A'}</td>`}
                                <td>${firstIn}</td>
                                <td>${lastOut}</td>
                                <td>${shiftData.shift_start}</td>
                                <td>${shiftData.shift_end}</td>
                                <td>${record.status}</td>
                                <td>${newawh1}:${newawh2}</td>
                                <td>${newot1}:${newot2}</td>
                            </tr>
                        `;
                    
                    
                    }
// }
//                         html += `
//                             <tr>
//                                 <td>${record.shift_date}</td>
//                                 ${index === 0 && empData.attendance[1] && empData.attendance[1].shift_date === record.shift_date ? `<td rowspan="${empData.attendance.filter(r => r.shift_date === record.shift_date).length}">${empId}</td>` : `<td>${empId}</td>`}
//                                 ${index === 0 && empData.attendance[1] && empData.attendance[1].shift_date === record.shift_date ? `<td rowspan="${empData.attendance.filter(r => r.shift_date === record.shift_date).length}">${empData.emp_name}</td>` : `<td>${empData.emp_name}</td>`}
//                                 ${index === 0 && empData.attendance[1] && empData.attendance[1].shift_date === record.shift_date ? `<td rowspan="${empData.attendance.filter(r => r.shift_date === record.shift_date).length}">${empData.grade || 'N/A'}</td>` : `<td>${empData.grade || 'N/A'}</td>`}
//                                 ${index === 0 && empData.attendance[1] && empData.attendance[1].shift_date === record.shift_date ? `<td rowspan="${empData.attendance.filter(r => r.shift_date === record.shift_date).length}">${empData.designation || 'N/A'}</td>` : `<td>${empData.designation || 'N/A'}</td>`}
//                                 <td>${firstIn}</td>
//                                 <td>${lastOut}</td>
//                                 <td>${shiftData.shift_start}</td>
//                                 <td>${shiftData.shift_end}</td>
//                                 <td>${record.status}</td>
//                                 <td>${newawh1}:${newawh2}</td>
//                                 <td>${newot1}:${newot2}</td>
//                             </tr>
//                         `;
                    });
                }

                html += '</tbody></table>';

            }
          
        }
    }

    container.innerHTML = html;


}


// ${index === 0 ? `<td rowspan="${empData.attendance.length}">${empId}</td>` : ''}
//                                 ${index === 0 ? `<td rowspan="${empData.attendance.length}">${empData.emp_name}</td>` : ''}
//                                 ${index === 0 ? `<td rowspan="${empData.attendance.length}">${empData.grade || 'N/A'}</td>` : ''}
//                                 ${index === 0 ? `<td rowspan="${empData.attendance.length}">${empData.designation || 'N/A'}</td>` : ''}
//                                 <td>${record.shift_date}</td>

        function printDivAsPDF(divId) {
            const { jsPDF } = window.jspdf;
            const divElement = document.getElementById(divId);
        
            html2canvas(divElement, { scale: 1 }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const imgWidth = pageWidth;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
        
                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
        
                while (heightLeft > 0) {
                    position = heightLeft - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
        
                doc.save('div-content.pdf');
            }).catch(error => {
                console.error('Error generating PDF:', error);
            });
        }
        


document.getElementById('btn-export').addEventListener('click', async () => {
    const div = document.getElementById('reportDataContainer');
    const elements = div.querySelectorAll('h1, h2, h3, h4, p, table, img');

    // Initialize workbook and worksheet
    const workbook = new ExcelJS.Workbook();
    const worksheet = workbook.addWorksheet('General Attendance Report');

    // Define styles
    const styles = {
        h1: { font: { size: 24, bold: true } },
        h2: { font: { size: 20, bold: true } },
        h3: { font: { size: 18, bold: true } },
        h4: { font: { size: 16, bold: true } },
        p: { font: { size: 12 } },
        tableHeader: { 
            font: { bold: true }, 
            fill: { type: 'pattern', pattern: 'solid', fgColor: { argb: 'C0C0C0' } } 
        }
    };

    async function getBase64Image(url) {
        const response = await fetch(url);
        const blob = await response.blob();
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result.split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(blob);
        });
    }

    /*
    function formatExcelDate(serial) {
        const utcDays = Math.floor(serial - 25569);
        const utcValue = utcDays * 86400;
        const dateInfo = new Date(utcValue * 1000);

        const fractionalDay = serial - Math.floor(serial) + 0.0000001;
        let totalSeconds = Math.floor(86400 * fractionalDay);

        const seconds = totalSeconds % 60;
        totalSeconds -= seconds;

        const hours = Math.floor(totalSeconds / (60 * 60));
        const minutes = Math.floor(totalSeconds / 60) % 60;

        return new Date(dateInfo.getFullYear(), dateInfo.getMonth(), dateInfo.getDate(), hours, minutes, seconds);
    }
*/

    function formatExcelDate(serial) {
    const utcDays = Math.floor(serial - 25569);
    const utcValue = utcDays * 86400;
    const dateInfo = new Date(utcValue * 1000);
    const fractionalDay = serial - Math.floor(serial) + 0.0000001;
    let totalSeconds = Math.floor(86400 * fractionalDay);
    const seconds = totalSeconds % 60;
    totalSeconds -= seconds;
    const hours = Math.floor(totalSeconds / (60 * 60));
    const minutes = Math.floor(totalSeconds / 60) % 60;

    const date = new Date(dateInfo.getFullYear(), dateInfo.getMonth(), dateInfo.getDate(), hours, minutes, seconds);
    
    // Format date as DD-MM-YYYY
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based
    const year = date.getFullYear();
    return `${month}-${day}-${year}`;
}


    function isSerialDate(value) {
        return typeof value === 'number' && value > 40000; // Some threshold for likely dates
    }

    // Embed the image at the top
    const imgElement = div.querySelector('img');
    if (imgElement) {
        const imgData = await getBase64Image(imgElement.src);

        const image = workbook.addImage({
            base64: imgData,
            extension: 'png',
        });

        worksheet.addImage(image, {
            tl: { col: 0, row: 0 },
            ext: { width: 500, height: 200 }
        });
    }

    // Start adding other elements from row 12
    let rowOffset = 12;

    elements.forEach(element => {
        if (element.tagName === 'TABLE') {
            const tableData = XLSX.utils.sheet_to_json(XLSX.utils.table_to_sheet(element), { header: 1 });

            tableData.forEach((row, rowIndex) => {
                const rowNum = rowOffset + rowIndex;
                const excelRow = worksheet.getRow(rowNum);

                row.forEach((cell, colIndex) => {
                    const cellRef = excelRow.getCell(colIndex + 1);
                    
                    if (isSerialDate(cell)) {
                    //    cellRef.value = formatExcelDate(cell).toISOString().split('T')[0];
                    cellRef.value = formatExcelDate(cell);
    
                } else {
                        cellRef.value = cell;
                    }

                    // Apply header style
                    if (rowIndex === 0) {
                        cellRef.style = styles.tableHeader;
                    }
                });
                excelRow.height = undefined; // Let the row auto-fit its content
                excelRow.commit();
            });

            // Add an empty row after table
            rowOffset += tableData.length + 1;
        } else if (element.tagName.startsWith('H') || element.tagName === 'P') {
            const rowNum = rowOffset++;
            const row = worksheet.getRow(rowNum);
            row.getCell(1).value = element.innerText;

            // Apply text styles
            const tag = element.tagName.toLowerCase();
            if (styles[tag]) {
                row.getCell(1).style = styles[tag];
            }
            row.height = undefined; // Let the row auto-fit its content
            row.commit();
        }
    });

    // Auto fit columns width
    worksheet.columns.forEach(column => {
        let maxLength = 0;
        column.eachCell({ includeEmpty: true }, cell => {
            const length = cell.value ? cell.value.toString().length : 10;
            if (length > maxLength) {
                maxLength = length;
            }
        });
        column.width = maxLength + 2; // Add some padding

    });

    // Save workbook to file
    const buf = await workbook.xlsx.writeBuffer();
    const blob = new Blob([buf], { type: 'application/octet-stream' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'General Attendance Report.xlsx';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
});






    // Function to check if a value is a date
    function isDate(value) {
        // Check if the value is a number and within a reasonable date range
        return !isNaN(value) && value > 25569 && value < 2958465; // Excel date range
    }
    
    // Function to format dates
    function formatDate(excelDate) {
        const date = new Date((excelDate - 25569) * 86400 * 1000);
        const day = String(date.getUTCDate()).padStart(2, '0');
        const month = String(date.getUTCMonth() + 1).padStart(2, '0'); // Months are zero-based
        const year = date.getUTCFullYear();
        return `${year}-${month}-${day}`;
    }
    





    document.getElementById('triggerSync').addEventListener('click', async () => {
        try {
          const response = await fetch('/sync2', { method: 'POST' });
        //   const data = await response.json();
        //   alert(data.message);
        } catch (error) {
          console.error('Error triggering sync:', error);
          alert('Failed to trigger data synchronization');
        }
      });

      document.getElementById('jumpPageButton').addEventListener('click', () => {
        const totalPages = parseInt(document.getElementById('totalPages').textContent, 10);
        let jumpPage = parseInt(document.getElementById('jumpPageInput').value, 10);
        
        if (jumpPage >= 1 && jumpPage <= totalPages) {
            currentPage = jumpPage;
            fetchGARReport(currentPage, limit);
        } else {
            alert('Please enter a valid page number.');
        }
    });
    





// Inside your <script> tag in the HTML

    let currentPage = 1;
    const limit = 100000; // Must match the default limit in backend
    
    document.getElementById('prevPage').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            fetchGARReport(currentPage, limit);
        }
    });
    
    document.getElementById('nextPage').addEventListener('click', () => {
        currentPage++;
        fetchGARReport(currentPage, limit);
    });
    
    async function fetchGARReport(page = 1, limit = 100000) {
        const loadingSpinner = document.getElementById('loadingSpinner');
        loadingSpinner.style.display = 'block';
        document.getElementById('errorMessage').style.display = 'none';
        
        try {
            const filters = {
                dateFrom: document.getElementById('dateFrom').value,
                dateTo: document.getElementById('dateTo').value,
                empId: document.getElementById('empId').value,
                empName: document.getElementById('empName').value,
                department: document.getElementById('department').value,
                site: document.getElementById('site').value,
                nationality: document.getElementById('nationality').value,
                visa: document.getElementById('visa').value
            };
    
            logDebug('Fetching report with filters and pagination', { filters, page, limit });
    
            // Only include non-empty filters in the query string
            const queryParams = new URLSearchParams(
                Object.fromEntries(
                    Object.entries(filters).filter(([_, v]) => v !== '')
                )
            );
            queryParams.append('page', page);
            queryParams.append('limit', limit);
            const queryString = queryParams.toString();
    
            const response = await fetch(`/api/attendance-report${queryString ? `?${queryString}` : ''}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            logDebug('Received report data', data);
    
            displayReport(data.report);
            document.getElementById('printButton').style.display = 'block';
            document.getElementById('btn-export').style.display = 'block';
            document.getElementById('paginationControls').style.display = 'block';
    
            // Update pagination controls
            const totalPages = Math.ceil(data.totalRecords / limit);
            document.getElementById('currentPage').textContent = data.page;
            document.getElementById('totalPages').textContent = totalPages;
    
            // Show or hide pagination controls based on total pages
            const paginationControls = document.getElementById('paginationControls');
            if (totalPages > 1) {
                paginationControls.style.display = 'block';
            } else {
                paginationControls.style.display = 'none';
            }
    
            logDebug('Report displayed successfully');
        } catch (error) {
            showError('Error fetching report', error);
            document.getElementById('reportContainer').innerHTML = '<p>Error fetching report. Please try again.</p>';
        } finally {
            loadingSpinner.style.display = 'none';
        }
    }
    
    function resetFilters() {
        logDebug('Resetting all filters');
        document.getElementById('dateFrom').value = '';
        document.getElementById('dateTo').value = '';
        document.getElementById('empId').value = '';
        document.getElementById('empName').value = '';
        document.getElementById('department').value = '';
        document.getElementById('site').value = '';
        document.getElementById('nationality').value = '';
        document.getElementById('visa').value = '';
        currentPage = 1; // Reset to first page
    
        // Fetch report without filters after reset
        fetchGARReport(currentPage, limit);
    }
    





    </script>


</body>
</html>