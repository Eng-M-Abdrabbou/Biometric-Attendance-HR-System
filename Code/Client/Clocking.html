<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form action="" method="post" style="margin: auto;">
<h3>Type your ID</h3>
<br>
<input type="text" name="id" id="input">
   <br>
    
    </form>
    <button style="Display: none;" type="submit" id="in"> Clock In </button>
    <button style="Display: none;" type="submit" id="out"> Clock out </button>
</body>
<script>

async function getEmployeeById(id) {
//if(id.length===3){
  
    const response = await fetch(`/api/employees/${id}`);
  const employee = await response.json();
  const jsonString = JSON.stringify(employee);
  console.log(jsonString);
  const valueOnly = jsonString.replace(/[^0-9]/g, '');
  console.log(valueOnly);
  //console.log(employee);
  return employee;
//}
  
}

const inputField = document.getElementById('input');

inputField.addEventListener('input', testInput);

async function testInput() {
  const input = inputField.value;
  try {
    const employee = await getEmployeeById(input);
    console.log(employee.value);
   
    const jsonString = JSON.stringify(employee);
  console.log(jsonString);
  const valueOnly = jsonString.replace(/[^0-9]/g, '');

  document.getElementById('in').addEventListener('click', async () => {
    try {
        const response = await fetch(`/api/input/${valueOnly}`, {
            method: 'POST'
        });
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        console.log(data);

        document.getElementById('in').style.display = 'none';
        document.getElementById('out').style.display = 'block';
    } catch (error) {
        console.error('Error during fetch:', error);
    }
});

document.getElementById('out').addEventListener('click', async () => {
  try {
      const response = await fetch(`/api/update/${valueOnly}`, {
          method: 'PATCH'
      });
      if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
      }
      const data = await response.json();
      console.log(data);

      document.getElementById('in').style.display = 'none';
      document.getElementById('out').style.display = 'block';
  } catch (error) {
      console.error('Error during fetch:', error);
  }
});


    console.log(inputField.value);
    if (valueOnly === inputField.value) {
      console.log('employee found!');
      const response = await fetch(`/isClocekdin/${valueOnly}`);
      const clocked = await response.json();
      console.log(clocked);
      if (clocked === false) {
        console.log('Success!');
        document.getElementById('in').style.display = 'block';
        document.getElementById('out').style.display = 'none';
      } else {
        document.getElementById('in').style.display = 'none';
        document.getElementById('out').style.display = 'block';
      }
    } else if  (valueOnly !== inputField.value){
      console.log('Employee not found');
      document.getElementById('in').style.display = 'none';
    }
  } catch (error) {
    console.error('Error testing input:', error);
  }
}






 




</script>
</html>

